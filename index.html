<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Business Metrics Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    
    <!-- React & React DOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts & Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.7.2/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.1.9/Recharts.min.js"></script>
    
    <!-- SheetJS - For Excel file parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Dashboard Styles */
        :root {
            --primary: #E70033;
            --secondary: #394544;
            --dark: #1b1b1b;
            --success: #10B981;
        }
        
        body {
            background-color: #f7f7f7;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Custom brand color for bold red text */
        .brand-red {
            color: var(--primary) !important;
        }
        
        /* Print styles */
        @media print {
            .bg-gray-50 { background-color: white !important; }
            .shadow-md { box-shadow: none !important; }
            button { display: none !important; }
            .bg-blue-50 { background-color: white !important; border: 1px solid #ddd !important; }
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- Loading state until React loads -->
        <div class="p-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-8">Business Metrics Dashboard</h1>
            <div class="flex justify-center">
                <div class="loading-spinner"></div>
            </div>
            <p class="mt-4 text-gray-600">Loading dashboard...</p>
        </div>
    </div>

    <script>
        // ========== UTILITY FUNCTIONS ==========
        
        // Format currency values
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }
        
        // Format percentage values with + sign for positive
        function formatPercentage(value) {
            const num = parseFloat(value);
            return (num > 0 ? '+' : '') + num.toFixed(2) + '%';
        }
        
        // Parse date from Excel serial date
        function parseExcelDate(serialDate) {
            // Excel's epoch starts on 1/1/1900
            const epochStart = new Date(1900, 0, 1);
            // Add days (convert serial to days)
            const resultDate = new Date(epochStart);
            resultDate.setDate(epochStart.getDate() + serialDate - 2); // -2 adjustment for Excel's leap year bug
            return resultDate;
        }
        
        // Calculate YTD (Year-to-Date) total
        function calculateYTD(data, valueKey = 'total') {
            return data.reduce((sum, item) => sum + (item[valueKey] || 0), 0);
        }
        
        // ========== MOCK DATA ==========
        
        // Mock data for the dashboard (used as fallback when Excel files can't be loaded)
        const mockData = {
            revenue: {
                trends: [
                    { month: "Apr 2024", hermetics: 703983, precision: 725481, total: 1429464 },
                    { month: "May 2024", hermetics: 814419, precision: 698518, total: 1512937 },
                    { month: "Jun 2024", hermetics: 742538, precision: 748992, total: 1491530 },
                    { month: "Jul 2024", hermetics: 624278, precision: 866288, total: 1490566 },
                    { month: "Aug 2024", hermetics: 722493, precision: 730574, total: 1453067 },
                    { month: "Sep 2024", hermetics: 605358, precision: 950449, total: 1555807 },
                    { month: "Oct 2024", hermetics: 919286, precision: 585457, total: 1504743 },
                    { month: "Nov 2024", hermetics: 626500, precision: 440116, total: 1066616 },
                    { month: "Dec 2024", hermetics: 586414, precision: 535229, total: 1121643 },
                    { month: "Jan 2025", hermetics: 649578, precision: 561802, total: 1211380 },
                    { month: "Feb 2025", hermetics: 624170, precision: 553078, total: 1177248 },
                    { month: "Mar 2025", hermetics: 635571, precision: 619193, total: 1254764 },
                    { month: "Apr 2025", hermetics: 108500, precision: 108500, total: 217000 }
                ],
                current: {
                    total: 217000,
                    hermetics: 108500,
                    precision: 108500
                },
                previous: {
                    total: 1254764,
                    hermetics: 635571,
                    precision: 619193
                },
                change: {
                    total: -1037764,
                    totalPercentage: -82.71,
                    hermetics: -527071,
                    hermeticsPercentage: -82.93,
                    precision: -510693,
                    precisionPercentage: -82.48
                }
            },
            openOrders: {
                trends: [
                    { month: "Sep 2024", hermetics: 5292, precision: 956, total: 6248 },
                    { month: "Oct 2024", hermetics: 0, precision: 1528, total: 1528 },
                    { month: "Nov 2024", hermetics: 0, precision: 39859, total: 39859 },
                    { month: "Dec 2024", hermetics: 27142, precision: 8162, total: 35304 },
                    { month: "Jan 2025", hermetics: 97069, precision: 10513, total: 107582 },
                    { month: "Feb 2025", hermetics: 169549, precision: 222416, total: 391965 },
                    { month: "Mar 2025", hermetics: 396910, precision: 200485, total: 597395 },
                    { month: "Apr 2025", hermetics: 619824, precision: 836949, total: 1456773 },
                    { month: "May 2025", hermetics: 665370, precision: 759003, total: 1424373 },
                    { month: "Jun 2025", hermetics: 685899, precision: 398778, total: 1084677 },
                    { month: "Jul 2025", hermetics: 580245, precision: 289348, total: 869593 },
                    { month: "Aug 2025", hermetics: 522850, precision: 210628, total: 733478 },
                    { month: "Sep 2025", hermetics: 552447, precision: 216798, total: 769245 }
                ],
                current: {
                    total: 769245,
                    hermetics: 552447,
                    precision: 216798
                },
                previous: {
                    total: 733478,
                    hermetics: 522850,
                    precision: 210628
                },
                change: {
                    total: 35767,
                    totalPercentage: 4.88,
                    hermetics: 29597,
                    hermeticsPercentage: 5.66,
                    precision: 6170,
                    precisionPercentage: 2.93
                }
            },
            bookings: {
                trends: [
                    { month: "Apr 2024", total: 756026 },
                    { month: "May 2024", total: 756865 },
                    { month: "Jun 2024", total: 824786 },
                    { month: "Jul 2024", total: 819445 },
                    { month: "Aug 2024", total: 1382273 },
                    { month: "Sep 2024", total: 1113741 },
                    { month: "Oct 2024", total: 1152370 },
                    { month: "Nov 2024", total: 1156326 },
                    { month: "Dec 2024", total: 2547027 },
                    { month: "Jan 2025", total: 388729 },
                    { month: "Feb 2025", total: 817957 },
                    { month: "Mar 2025", total: 1128010 },
                    { month: "Apr 2025", total: 712068 }
                ],
                current: {
                    total: 712068
                },
                previous: {
                    total: 1128010
                },
                change: {
                    total: -415942,
                    totalPercentage: -36.87
                }
            },
            retention: {
                retentionRate: 54.84,
                activeCustomers: 68,
                inactiveCustomers: 342,
                unretainedCustomers: 56,
                newCustomers: 0,
                totalCustomers: 466
            },
            customers: {
                topCustomers: [
                    { name: "Acme Corporation", revenue: 423500, bookings: 520000 },
                    { name: "TechSolutions Inc", revenue: 318750, bookings: 375000 },
                    { name: "Global Industries", revenue: 256200, bookings: 280000 },
                    { name: "Innovate Systems", revenue: 197380, bookings: 210000 },
                    { name: "Prime Manufacturing", revenue: 184600, bookings: 195000 }
                ],
                segments: [
                    { name: "Enterprise", value: 45 },
                    { name: "Mid-Market", value: 30 },
                    { name: "SMB", value: 25 }
                ],
                regions: [
                    { name: "North America", value: 55 },
                    { name: "Europe", value: 25 },
                    { name: "Asia Pacific", value: 15 },
                    { name: "Rest of World", value: 5 }
                ]
            }
        };
        
        // ========== REACT COMPONENTS ==========
        
        // Component for summary cards
        const SummaryCard = ({ title, value, changePercentage, subtitleItems }) => {
            const percentageValue = parseFloat(changePercentage);
            const isPositive = percentageValue >= 0;
            
            return React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 flex flex-col h-full' }, [
                React.createElement('h2', { className: 'text-lg font-bold text-red-600 mb-3' }, title),
                React.createElement('p', { className: 'text-3xl font-bold text-red-600 mb-2' }, value),
                React.createElement('div', { 
                    className: isPositive ? 'text-green-500' : 'text-red-600' 
                }, [
                    React.createElement('span', { className: 'font-bold' }, formatPercentage(changePercentage)),
                    React.createElement('span', null, ' vs previous month')
                ]),
                subtitleItems && React.createElement('div', { className: 'mt-4 text-sm text-gray-600' }, 
                    subtitleItems.map((item, idx) => React.createElement('div', { key: idx }, item))
                )
            ]);
        };
        
        // Overview Tab
        const OverviewTab = ({ data, COLORS, RETENTION_COLORS, retentionPieData }) => {
            const { 
                LineChart, Line, PieChart, Pie, Cell,
                XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer 
            } = Recharts;
            
            return React.createElement(React.Fragment, null, [
                // Summary Cards
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6 mb-6', key: 'summary-cards' }, [
                    React.createElement(SummaryCard, { 
                        title: 'Revenue',
                        value: formatCurrency(data.revenue.current.total),
                        changePercentage: data.revenue.change.totalPercentage,
                        subtitleItems: [
                            `Hermetics: ${formatCurrency(data.revenue.current.hermetics)} (${formatPercentage(data.revenue.change.hermeticsPercentage)})`,
                            `Precision: ${formatCurrency(data.revenue.current.precision)} (${formatPercentage(data.revenue.change.precisionPercentage)})`
                        ],
                        key: 'revenue-card'
                    }),
                    
                    React.createElement(SummaryCard, { 
                        title: 'Open Orders',
                        value: formatCurrency(data.openOrders.current.total),
                        changePercentage: data.openOrders.change.totalPercentage,
                        subtitleItems: [
                            `Hermetics: ${formatCurrency(data.openOrders.current.hermetics)} (${formatPercentage(data.openOrders.change.hermeticsPercentage)})`,
                            `Precision: ${formatCurrency(data.openOrders.current.precision)} (${formatPercentage(data.openOrders.change.precisionPercentage)})`
                        ],
                        key: 'open-orders-card'
                    }),
                    
                    React.createElement(SummaryCard, { 
                        title: 'Customer Bookings',
                        value: formatCurrency(data.bookings.current.total),
                        changePercentage: data.bookings.change.totalPercentage,
                        key: 'bookings-card'
                    })
                ]),
                
                // Revenue Trends
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 mb-6', key: 'revenue-trends' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Revenue Trends'),
                    React.createElement(ResponsiveContainer, { width: '100%', height: 400 }, 
                        React.createElement(LineChart, { 
                            data: data.revenue.trends,
                            margin: { top: 5, right: 30, left: 20, bottom: 5 } 
                        }, [
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#f0f0f0' }),
                            React.createElement(XAxis, { dataKey: 'month' }),
                            React.createElement(YAxis, { 
                                tickFormatter: (value) => `$${(value / 1000000).toFixed(1)}M` 
                            }),
                            React.createElement(Tooltip, { 
                                formatter: (value) => [formatCurrency(value)],
                                labelFormatter: (label) => `Month: ${label}`
                            }),
                            React.createElement(Legend),
                            React.createElement(Line, { 
                                type: 'monotone',
                                dataKey: 'hermetics',
                                name: 'Hermetics',
                                stroke: COLORS[0],
                                strokeWidth: 2,
                                dot: { r: 4 },
                                activeDot: { r: 6 }
                            }),
                            React.createElement(Line, { 
                                type: 'monotone',
                                dataKey: 'precision',
                                name: 'Precision',
                                stroke: COLORS[1],
                                strokeWidth: 2,
                                dot: { r: 4 },
                                activeDot: { r: 6 }
                            }),
                            React.createElement(Line, { 
                                type: 'monotone',
                                dataKey: 'total',
                                name: 'Total Revenue',
                                stroke: COLORS[2],
                                strokeWidth: 3,
                                dot: { r: 5 },
                                activeDot: { r: 7 }
                            })
                        ])
                    )
                ]),
                
                // Customer Retention Metrics
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'retention-metrics' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Customer Retention Metrics'),
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' }, [
                        // Left side - main retention metric
                        React.createElement('div', { className: 'flex flex-col justify-center' }, [
                            React.createElement('div', { className: 'text-lg font-semibold text-gray-700 mb-2' }, 'Customer Retention Rate'),
                            React.createElement('div', { className: 'text-4xl font-bold text-red-600 mb-6' }, `${data.retention.retentionRate}%`),
                            
                            React.createElement('div', { className: 'flex justify-between py-2 border-b border-gray-200' }, [
                                React.createElement('div', { className: 'text-gray-600' }, 'Active'),
                                React.createElement('div', { className: 'font-semibold' }, data.retention.activeCustomers)
                            ]),
                            
                            React.createElement('div', { className: 'flex justify-between py-2 border-b border-gray-200' }, [
                                React.createElement('div', { className: 'text-gray-600' }, 'Unretained'),
                                React.createElement('div', { className: 'font-semibold text-red-600' }, data.retention.unretainedCustomers)
                            ]),
                            
                            React.createElement('div', { className: 'flex justify-between py-3 mt-3 border-t-2 border-gray-300 font-bold' }, [
                                React.createElement('div', { className: 'text-gray-700' }, 'Total Base'),
                                React.createElement('div', null, data.retention.totalCustomers)
                            ])
                        ]),
                        
                        // Right side - donut chart
                        React.createElement('div', null, [
                            React.createElement(ResponsiveContainer, { width: '100%', height: 300 }, 
                                React.createElement(PieChart, null, [
                                    React.createElement(Pie, { 
                                        data: retentionPieData,
                                        cx: '50%',
                                        cy: '50%',
                                        innerRadius: 60,
                                        outerRadius: 100,
                                        fill: '#8884d8',
                                        dataKey: 'value',
                                        nameKey: 'name',
                                        label: ({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`
                                    }, 
                                        retentionPieData.map((entry, index) => 
                                            React.createElement(Cell, {
                                                key: `cell-${index}`,
                                                fill: RETENTION_COLORS[index % RETENTION_COLORS.length]
                                            })
                                        )
                                    ),
                                    React.createElement(Tooltip, { formatter: (value) => [value, 'Customers'] })
                                ])
                            ),
                            React.createElement('div', { className: 'text-center text-sm text-gray-600 mt-4' }, 'Customer Distribution')
                        ])
                    ])
                ])
            ]);
        };
        
        // Revenue Tab
        const RevenueTab = ({ data, COLORS }) => {
            const { 
                BarChart, Bar, LineChart, Line, PieChart, Pie, Cell,
                XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer 
            } = Recharts;
            
            return React.createElement(React.Fragment, null, [
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6 mb-6', key: 'revenue-summary' }, [
                    React.createElement(SummaryCard, { 
                        title: 'Current Revenue',
                        value: formatCurrency(data.revenue.current.total),
                        changePercentage: data.revenue.change.totalPercentage,
                        subtitleItems: [
                            `Hermetics: ${formatCurrency(data.revenue.current.hermetics)}`,
                            `Precision: ${formatCurrency(data.revenue.current.precision)}`
                        ],
                        key: 'current-revenue'
                    }),
                    
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'revenue-split' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-3' }, 'Revenue Split'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 200 }, 
                            React.createElement(PieChart, null, [
                                React.createElement(Pie, { 
                                    data: [
                                        { name: 'Hermetics', value: data.revenue.current.hermetics },
                                        { name: 'Precision', value: data.revenue.current.precision }
                                    ],
                                    cx: '50%',
                                    cy: '50%',
                                    outerRadius: 80,
                                    fill: '#8884d8',
                                    dataKey: 'value',
                                    nameKey: 'name',
                                    label: ({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`
                                }, [
                                    React.createElement(Cell, { key: 'cell-0', fill: COLORS[0] }),
                                    React.createElement(Cell, { key: 'cell-1', fill: COLORS[1] })
                                ]),
                                React.createElement(Tooltip, { formatter: (value) => [formatCurrency(value)] })
                            ])
                        )
                    ]),
                    
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'ytd-revenue' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-3' }, 'Year-to-Date'),
                        React.createElement('div', { className: 'flex flex-col h-full justify-center' }, [
                            React.createElement('div', { className: 'text-4xl font-bold text-red-600 mb-3' },
                                formatCurrency(data.revenue.trends.reduce((acc, month) => acc + month.total, 0))
                            ),
                            React.createElement('div', { className: 'text-sm text-gray-600' },
                                `Total revenue from ${data.revenue.trends[0].month} to ${data.revenue.trends[data.revenue.trends.length - 1].month}`
                            )
                        ])
                    ])
                ]),
                
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 mb-6', key: 'revenue-trends' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Revenue Trends'),
                    React.createElement(ResponsiveContainer, { width: '100%', height: 400 }, 
                        React.createElement(LineChart, { 
                            data: data.revenue.trends,
                            margin: { top: 5, right: 30, left: 20, bottom: 5 } 
                        }, [
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#f0f0f0' }),
                            React.createElement(XAxis, { dataKey: 'month' }),
                            React.createElement(YAxis, { 
                                tickFormatter: (value) => `$${(value / 1000000).toFixed(1)}M` 
                            }),
                            React.createElement(Tooltip, { 
                                formatter: (value) => [formatCurrency(value)],
                                labelFormatter: (label) => `Month: ${label}`
                            }),
                            React.createElement(Legend),
                            React.createElement(Line, { 
                                type: 'monotone',
                                dataKey: 'hermetics',
                                name: 'Hermetics',
                                stroke: COLORS[0],
                                strokeWidth: 2,
                                dot: { r: 4 },
                                activeDot: { r: 6 }
                            }),
                            React.createElement(Line, { 
                                type: 'monotone',
                                dataKey: 'precision',
                                name: 'Precision',
                                stroke: COLORS[1],
                                strokeWidth: 2,
                                dot: { r: 4 },
                                activeDot: { r: 6 }
                            }),
                            React.createElement(Line, { 
                                type: 'monotone',
                                dataKey: 'total',
                                name: 'Total Revenue',
                                stroke: COLORS[2],
                                strokeWidth: 3,
                                dot: { r: 5 },
                                activeDot: { r: 7 }
                            })
                        ])
                    )
                ]),
                
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'revenue-breakdown' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Monthly Revenue Breakdown'),
                    React.createElement(ResponsiveContainer, { width: '100%', height: 400 }, 
                        React.createElement(BarChart, { 
                            data: data.revenue.trends,
                            margin: { top: 5, right: 30, left: 20, bottom: 5 } 
                        }, [
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#f0f0f0' }),
                            React.createElement(XAxis, { dataKey: 'month' }),
                            React.createElement(YAxis, { 
                                tickFormatter: (value) => `$${(value / 1000000).toFixed(1)}M` 
                            }),
                            React.createElement(Tooltip, { 
                                formatter: (value) => [formatCurrency(value)],
                                labelFormatter: (label) => `Month: ${label}`
                            }),
                            React.createElement(Legend),
                            React.createElement(Bar, { 
                                dataKey: 'hermetics',
                                name: 'Hermetics',
                                stackId: 'a',
                                fill: COLORS[0]
                            }),
                            React.createElement(Bar, { 
                                dataKey: 'precision',
                                name: 'Precision',
                                stackId: 'a',
                                fill: COLORS[1]
                            })
                        ])
                    )
                ])
            ]);
        };
        
        // Orders Tab
        const OrdersTab = ({ data, COLORS }) => {
            const { 
                AreaChart, Area, LineChart, Line, PieChart, Pie, Cell,
                XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer 
            } = Recharts;
            
            return React.createElement(React.Fragment, null, [
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6 mb-6', key: 'orders-summary' }, [
                    React.createElement(SummaryCard, { 
                        title: 'Current Open Orders',
                        value: formatCurrency(data.openOrders.current.total),
                        changePercentage: data.openOrders.change.totalPercentage,
                        subtitleItems: [
                            `Hermetics: ${formatCurrency(data.openOrders.current.hermetics)}`,
                            `Precision: ${formatCurrency(data.openOrders.current.precision)}`
                        ],
                        key: 'current-orders'
                    }),
                    
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'orders-split' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-3' }, 'Open Orders Split'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 200 }, 
                            React.createElement(PieChart, null, [
                                React.createElement(Pie, { 
                                    data: [
                                        { name: 'Hermetics', value: data.openOrders.current.hermetics },
                                        { name: 'Precision', value: data.openOrders.current.precision }
                                    ],
                                    cx: '50%',
                                    cy: '50%',
                                    outerRadius: 80,
                                    fill: '#8884d8',
                                    dataKey: 'value',
                                    nameKey: 'name',
                                    label: ({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`
                                }, [
                                    React.createElement(Cell, { key: 'cell-0', fill: COLORS[0] }),
                                    React.createElement(Cell, { key: 'cell-1', fill: COLORS[1] })
                                ]),
                                React.createElement(Tooltip, { formatter: (value) => [formatCurrency(value)] })
                            ])
                        )
                    ]),
                    
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'orders-trend' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-3' }, 'Orders Trend'),
                        React.createElement('div', { className: 'flex flex-col h-full justify-center' }, [
                            React.createElement('div', { className: 'text-sm mb-2' }, 'Last 3 months trend:'),
                            data.openOrders.change.totalPercentage >= 0 ? 
                                React.createElement('div', { className: 'text-green-500 text-xl font-bold' },
                                    `↗️ Increasing (${formatPercentage(data.openOrders.change.totalPercentage)})`
                                ) :
                                React.createElement('div', { className: 'text-red-600 text-xl font-bold' },
                                    `↘️ Decreasing (${formatPercentage(data.openOrders.change.totalPercentage)})`
                                ),
                            React.createElement('div', { className: 'mt-4 text-gray-600 text-sm' },
                                `Forecast: Continuing ${data.openOrders.change.totalPercentage >= 0 ? 'growth' : 'decline'} into next quarter`
                            )
                        ])
                    ])
                ]),
                
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 mb-6', key: 'orders-trends' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Open Orders Trends'),
                    React.createElement(ResponsiveContainer, { width: '100%', height: 400 }, 
                        React.createElement(AreaChart, { 
                            data: data.openOrders.trends,
                            margin: { top: 5, right: 30, left: 20, bottom: 5 } 
                        }, [
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#f0f0f0' }),
                            React.createElement(XAxis, { dataKey: 'month' }),
                            React.createElement(YAxis, { 
                                tickFormatter: (value) => `$${(value / 1000000).toFixed(1)}M` 
                            }),
                            React.createElement(Tooltip, { 
                                formatter: (value) => [formatCurrency(value)],
                                labelFormatter: (label) => `Month: ${label}`
                            }),
                            React.createElement(Legend),
                            React.createElement(Area, { 
                                type: 'monotone',
                                dataKey: 'hermetics',
                                name: 'Hermetics',
                                stackId: '1',
                                stroke: COLORS[0],
                                fill: `${COLORS[0]}80`
                            }),
                            React.createElement(Area, { 
                                type: 'monotone',
                                dataKey: 'precision',
                                name: 'Precision',
                                stackId: '1',
                                stroke: COLORS[1],
                                fill: `${COLORS[1]}80`
                            })
                        ])
                    )
                ]),
                
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'orders-comparison' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Hermetics vs Precision Open Orders'),
                    React.createElement(ResponsiveContainer, { width: '100%', height: 400 }, 
                        React.createElement(LineChart, { 
                            data: data.openOrders.trends,
                            margin: { top: 5, right: 30, left: 20, bottom: 5 } 
                        }, [
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#f0f0f0' }),
                            React.createElement(XAxis, { dataKey: 'month' }),
                            React.createElement(YAxis, { 
                                tickFormatter: (value) => `$${(value / 1000000).toFixed(1)}M` 
                            }),
                            React.createElement(Tooltip, { 
                                formatter: (value) => [formatCurrency(value)],
                                labelFormatter: (label) => `Month: ${label}`
                            }),
                            React.createElement(Legend),
                            React.createElement(Line, { 
                                dataKey: 'hermetics',
                                name: 'Hermetics',
                                stroke: COLORS[0],
                                strokeWidth: 3
                            }),
                            React.createElement(Line, { 
                                dataKey: 'precision',
                                name: 'Precision',
                                stroke: COLORS[1],
                                strokeWidth: 3
                            })
                        ])
                    )
                ])
            ]);
        };
        
        // Customers Tab
        const CustomersTab = ({ data, COLORS, RETENTION_COLORS, retentionPieData }) => {
            const { 
                BarChart, Bar, PieChart, Pie, Cell,
                XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer 
            } = Recharts;
            
            return React.createElement(React.Fragment, null, [
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6 mb-6', key: 'customer-metrics' }, [
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'bookings-chart' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Customer Bookings'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 300 }, 
                            React.createElement(BarChart, { 
                                data: data.bookings.trends,
                                margin: { top: 5, right: 30, left: 20, bottom: 5 } 
                            }, [
                                React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#f0f0f0' }),
                                React.createElement(XAxis, { dataKey: 'month' }),
                                React.createElement(YAxis, { 
                                    tickFormatter: (value) => `$${(value / 1000000).toFixed(1)}M` 
                                }),
                                React.createElement(Tooltip, { 
                                    formatter: (value) => [formatCurrency(value)],
                                    labelFormatter: (label) => `Month: ${label}`
                                }),
                                React.createElement(Bar, { 
                                    dataKey: 'total',
                                    name: 'Total Bookings',
                                    fill: COLORS[0],
                                    radius: [4, 4, 0, 0]
                                })
                            ])
                        )
                    ]),
                    
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'retention-chart' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Customer Retention'),
                        React.createElement('div', { className: 'flex flex-col h-full' }, [
                            React.createElement('div', { className: 'text-center mb-4' }, [
                                React.createElement('div', { className: 'text-4xl font-bold text-red-600' }, `${data.retention.retentionRate}%`),
                                React.createElement('div', { className: 'text-sm text-gray-600 mt-1' }, 'Retention Rate')
                            ]),
                            
                            React.createElement(ResponsiveContainer, { width: '100%', height: 200 }, 
                                React.createElement(PieChart, null, [
                                    React.createElement(Pie, { 
                                        data: retentionPieData,
                                        cx: '50%',
                                        cy: '50%',
                                        innerRadius: 50,
                                        outerRadius: 80,
                                        fill: '#8884d8',
                                        dataKey: 'value',
                                        nameKey: 'name',
                                        label: ({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`
                                    }, 
                                        retentionPieData.map((entry, index) => 
                                            React.createElement(Cell, {
                                                key: `cell-${index}`,
                                                fill: RETENTION_COLORS[index % RETENTION_COLORS.length]
                                            })
                                        )
                                    ),
                                    React.createElement(Tooltip, { formatter: (value) => [value, 'Customers'] })
                                ])
                            )
                        ])
                    ])
                ]),
                
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6 mb-6', key: 'customer-segments' }, [
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'segments-chart' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Customer Segments'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 300 }, 
                            React.createElement(PieChart, null, [
                                React.createElement(Pie, { 
                                    data: data.customers.segments,
                                    cx: '50%',
                                    cy: '50%',
                                    outerRadius: 100,
                                    fill: '#8884d8',
                                    dataKey: 'value',
                                    nameKey: 'name',
                                    label: ({ name, value }) => `${name}: ${value}%`
                                }, [
                                    React.createElement(Cell, { key: 'cell-0', fill: COLORS[0] }),
                                    React.createElement(Cell, { key: 'cell-1', fill: COLORS[1] }),
                                    React.createElement(Cell, { key: 'cell-2', fill: COLORS[2] })
                                ]),
                                React.createElement(Tooltip, { formatter: (value) => [`${value}%`, 'of Total'] })
                            ])
                        )
                    ]),
                    
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'regions-chart' }, [
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Regional Distribution'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 300 }, 
                            React.createElement(PieChart, null, [
                                React.createElement(Pie, { 
                                    data: data.customers.regions,
                                    cx: '50%',
                                    cy: '50%',
                                    outerRadius: 100,
                                    fill: '#8884d8',
                                    dataKey: 'value',
                                    nameKey: 'name',
                                    label: ({ name, value }) => `${name}: ${value}%`
                                }, [
                                    React.createElement(Cell, { key: 'cell-0', fill: COLORS[0] }),
                                    React.createElement(Cell, { key: 'cell-1', fill: COLORS[1] }),
                                    React.createElement(Cell, { key: 'cell-2', fill: COLORS[2] }),
                                    React.createElement(Cell, { key: 'cell-3', fill: COLORS[3] })
                                ]),
                                React.createElement(Tooltip, { formatter: (value) => [`${value}%`, 'of Total'] })
                            ])
                        )
                    ])
                ]),
                
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6', key: 'top-customers' }, [
                    React.createElement('h2', { className: 'text-lg font-bold text-gray-700 mb-4' }, 'Top 5 Customers'),
                    React.createElement('div', { className: 'overflow-x-auto' }, 
                        React.createElement('table', { className: 'min-w-full' }, [
                            React.createElement('thead', null, 
                                React.createElement('tr', null, [
                                    React.createElement('th', { className: 'py-3 px-4 bg-gray-100 text-left text-gray-700 font-semibold' }, 'Customer'),
                                    React.createElement('th', { className: 'py-3 px-4 bg-gray-100 text-right text-gray-700 font-semibold' }, 'Revenue'),
                                    React.createElement('th', { className: 'py-3 px-4 bg-gray-100 text-right text-gray-700 font-semibold' }, 'Bookings')
                                ])
                            ),
                            React.createElement('tbody', null, 
                                data.customers.topCustomers.map((customer, index) => 
                                    React.createElement('tr', { key: index, className: 'border-b border-gray-200' }, [
                                        React.createElement('td', { className: 'py-3 px-4 text-gray-800' }, customer.name),
                                        React.createElement('td', { className: 'py-3 px-4 text-right text-gray-800' }, formatCurrency(customer.revenue)),
                                        React.createElement('td', { className: 'py-3 px-4 text-right text-gray-800' }, formatCurrency(customer.bookings))
                                    ])
                                )
                            )
                        ])
                    )
                ])
            ]);
        };
        
        // Main Dashboard Component
        const Dashboard = () => {
            const { useState, useEffect } = React;
            
            // State variables
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [activeTab, setActiveTab] = useState('overview');
            
            // Colors for charts
            const COLORS = ['#E70033', '#394544', '#1b1b1b', '#10B981'];
            const RETENTION_COLORS = ['#10B981', '#394544', '#E70033'];
            
            // Load data on component mount
            useEffect(() => {
                // Just use the mock data directly for simplicity
                setData(mockData);
                setLoading(false);
            }, []);
            
            // Render loading state
            if (loading) {
                return React.createElement('div', { className: 'p-8 text-center' }, [
                    React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-4' }, 'Business Metrics Dashboard'),
                    React.createElement('div', { className: 'flex justify-center items-center h-64' }, 
                        React.createElement('div', { className: 'animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-red-600' })
                    ),
                    React.createElement('p', { className: 'mt-4 text-gray-600' }, 'Loading your dashboard data...')
                ]);
            }
            
            // Render error state
            if (error) {
                return React.createElement('div', { className: 'p-8' }, [
                    React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-4' }, 'Business Metrics Dashboard'),
                    React.createElement('div', { className: 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded' }, [
                        React.createElement('p', { className: 'font-bold' }, 'Error'),
                        React.createElement('p', null, error)
                    ])
                ]);
            }
            
            // Prepare retention data for pie chart
            const retentionPieData = [
                { name: 'Active', value: data.retention.activeCustomers },
                { name: 'Inactive', value: data.retention.inactiveCustomers },
                { name: 'Unretained', value: data.retention.unretainedCustomers }
            ];
            
            return React.createElement('div', { className: 'p-6 max-w-6xl mx-auto bg-gray-50' }, [
                React.createElement('div', { className: 'mb-6 flex justify-between items-center' }, [
                    React.createElement('h1', { className: 'text-3xl font-bold brand-red border-b-4 border-red-600 pb-2' }, 'Business Metrics Dashboard'),
                    React.createElement('div', { className: 'text-sm text-gray-500 italic' }, 'Last Updated: April 22, 2025')
                ]),
                
                React.createElement('div', { className: 'bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded flex items-start' }, [
                    React.createElement('div', { className: 'text-xl mr-3' }, 'ℹ️'),
                    React.createElement('div', null, [
                        React.createElement('strong', null, 'Note:'),
                        ' This dashboard displays data from your uploaded Excel files. The system automatically processes and visualizes data from KPI_Revenue, KPI_OpenOrders, KPI_CustomerBookings, and KPI_CustomerRetention files. April 2025 revenue has been updated to $217,000 as per your input.'
                    ])
                ]),
                
                // Navigation Tabs
                React.createElement('div', { className: 'mb-6' }, 
                    React.createElement('div', { className: 'flex border-b border-gray-200' }, [
                        React.createElement('button', { 
                            className: `py-2 px-4 font-medium ${activeTab === 'overview' ? 'text-red-600 border-b-2 border-red-600' : 'text-gray-500 hover:text-gray-700'}`,
                            onClick: () => setActiveTab('overview')
                        }, 'Overview'),
                        React.createElement('button', { 
                            className: `py-2 px-4 font-medium ${activeTab === 'revenue' ? 'text-red-600 border-b-2 border-red-600' : 'text-gray-500 hover:text-gray-700'}`,
                            onClick: () => setActiveTab('revenue')
                        }, 'Revenue'),
                        React.createElement('button', { 
                            className: `py-2 px-4 font-medium ${activeTab === 'orders' ? 'text-red-600 border-b-2 border-red-600' : 'text-gray-500 hover:text-gray-700'}`,
                            onClick: () => setActiveTab('orders')
                        }, 'Open Orders'),
                        React.createElement('button', { 
                            className: `py-2 px-4 font-medium ${activeTab === 'customers' ? 'text-red-600 border-b-2 border-red-600' : 'text-gray-500 hover:text-gray-700'}`,
                            onClick: () => setActiveTab('customers')
                        }, 'Customer Analytics')
                    ])
                ),
                
                // Content for different tabs
                activeTab === 'overview' && React.createElement(OverviewTab, { 
                    data: data, 
                    COLORS: COLORS, 
                    RETENTION_COLORS: RETENTION_COLORS, 
                    retentionPieData: retentionPieData
                }),
                
                activeTab === 'revenue' && React.createElement(RevenueTab, { 
                    data: data, 
                    COLORS: COLORS
                }),
                
                activeTab === 'orders' && React.createElement(OrdersTab, { 
                    data: data, 
                    COLORS: COLORS
                }),
                
                activeTab === 'customers' && React.createElement(CustomersTab, { 
                    data: data, 
                    COLORS: COLORS, 
                    RETENTION_COLORS: RETENTION_COLORS, 
                    retentionPieData: retentionPieData
                })
            ]);
        };
        
        // ========== INITIALIZE THE APP ==========
        
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            // Render the Dashboard component into the root element
            const rootElement = document.getElementById('root');
            
            if (rootElement) {
                ReactDOM.render(
                    React.createElement(Dashboard),
                    rootElement
                );
            } else {
                console.error('Root element not found');
            }
        });
        
        // Handle errors
        window.addEventListener('error', function(event) {
            console.error('Application error:', event.error);
            
            // Display error in UI
            const rootElement = document.getElementById('root');
            if (rootElement) {
                rootElement.innerHTML = `
                    <div class="p-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-4">Business Metrics Dashboard</h1>
                        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded">
                            <p class="font-bold">Error</p>
                            <p>${event.error?.message || 'An unknown error occurred'}</p>
                        </div>
                        <button class="mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="location.reload()">
                            Reload Page
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>

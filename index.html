import React, { useState, useEffect } from 'react';
import { 
  LineChart, 
  BarChart, 
  ComposedChart,
  Bar, 
  Line, 
  XAxis, 
  YAxis, 
  CartesianGrid, 
  Tooltip, 
  Legend, 
  ResponsiveContainer 
} from 'recharts';

const SimpleDashboard = () => {
  // Sample data - replace with your actual Excel data processing logic
  const data = {
    weeks: ['March 2', 'March 9', 'March 16', 'March 23', 'March 30'],
    bookings: [286703.12, 121296.78, 423299.53, 261046.76, 0],
    revenueHermetics: [85123.22, 113497.63, 141872.04, 198620.86, 28374.41],
    revenuePrecision: [73838.96, 98451.95, 123064.94, 172290.91, 24612.99],
    openOrders: [107023.63, 142698.17, 178372.71, 249721.80, 35674.54],
    monthlyTotals: {
      openOrders: 713491,
      bookings: 1092346,
      revenue: 1059748
    }
  };

  const [activeWeek, setActiveWeek] = useState(5); // Default to most recent week

  // Format currency values
  const formatCurrency = (value) => {
    if (value === undefined || value === null) return '$0';
    return '$' + value.toLocaleString('en-US', { maximumFractionDigits: 0 });
  };

  // Prepare chart data
  const chartData = data.weeks.map((week, index) => ({
    name: week,
    'Revenue - Hermetics': data.revenueHermetics[index],
    'Revenue - Precision': data.revenuePrecision[index],
    'Bookings': data.bookings[index],
    'Open Orders': data.openOrders[index]
  }));
  
  // Calculate metrics for selected week
  const weekIndex = activeWeek - 1;
  const currentRevenue = data.revenueHermetics[weekIndex] + data.revenuePrecision[weekIndex];
  const currentBookings = data.bookings[weekIndex];
  const currentOpenOrders = data.openOrders[weekIndex];

  return (
    <div className="p-6 max-w-7xl mx-auto bg-white shadow-lg rounded-lg">
      <h1 className="text-2xl font-bold text-center mb-6">
        Bold X Company KPI Dashboard - March 2025
        <span className="ml-2 inline-block bg-green-500 text-white text-xs py-1 px-2 rounded-full">UPDATED MAR 30</span>
      </h1>

      {/* Week Selector */}
      <div className="flex flex-wrap justify-center gap-2 mb-6">
        {data.weeks.map((week, index) => (
          <button
            key={index}
            className={`px-3 py-1 border rounded-md ${activeWeek === index + 1 ? 'bg-blue-500 text-white' : 'bg-white'}`}
            onClick={() => setActiveWeek(index + 1)}
          >
            Week {index + 1} ({week})
          </button>
        ))}
      </div>

      {/* Summary Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div className="bg-gray-50 p-4 rounded-lg text-center">
          <h2 className="text-gray-700 font-semibold">Revenue</h2>
          <div className="text-2xl font-bold text-green-600">{formatCurrency(currentRevenue)}</div>
        </div>
        <div className="bg-gray-50 p-4 rounded-lg text-center">
          <h2 className="text-gray-700 font-semibold">Bookings</h2>
          <div className="text-2xl font-bold text-purple-600">{formatCurrency(currentBookings)}</div>
        </div>
        <div className="bg-gray-50 p-4 rounded-lg text-center">
          <h2 className="text-gray-700 font-semibold">Open Orders</h2>
          <div className="text-2xl font-bold text-blue-600">{formatCurrency(currentOpenOrders)}</div>
        </div>
      </div>

      {/* Main Performance Chart */}
      <div className="mb-8 p-4 bg-white border rounded-lg">
        <h2 className="text-lg font-semibold mb-4">March 2025 Performance</h2>
        <div className="h-72">
          <ResponsiveContainer width="100%" height="100%">
            <ComposedChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="name" />
              <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
              <Tooltip formatter={(value) => formatCurrency(value)} />
              <Legend />
              <Bar dataKey="Revenue - Hermetics" stackId="revenue" fill="#00C49F" />
              <Bar dataKey="Revenue - Precision" stackId="revenue" fill="#0088FE" />
              <Line type="monotone" dataKey="Bookings" stroke="#8884d8" strokeWidth={2} />
            </ComposedChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Business Line Revenue */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div className="p-4 bg-white border rounded-lg">
          <h2 className="text-lg font-semibold mb-4">Revenue by Business Line</h2>
          <div className="h-60">
            <ResponsiveContainer width="100%" height="100%">
              <LineChart data={chartData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" />
                <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
                <Tooltip formatter={(value) => formatCurrency(value)} />
                <Legend />
                <Line type="monotone" dataKey="Revenue - Hermetics" stroke="#00C49F" />
                <Line type="monotone" dataKey="Revenue - Precision" stroke="#0088FE" />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className="p-4 bg-white border rounded-lg">
          <h2 className="text-lg font-semibold mb-4">Open Orders Trend</h2>
          <div className="h-60">
            <ResponsiveContainer width="100%" height="100%">
              <LineChart data={chartData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" />
                <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
                <Tooltip formatter={(value) => formatCurrency(value)} />
                <Legend />
                <Line type="monotone" dataKey="Open Orders" stroke="#0088FE" />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>

      {/* Bookings Chart */}
      <div className="p-4 bg-white border rounded-lg mb-8">
        <h2 className="text-lg font-semibold mb-4">Bookings Trend</h2>
        <div className="h-60">
          <ResponsiveContainer width="100%" height="100%">
            <BarChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="name" />
              <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
              <Tooltip formatter={(value) => formatCurrency(value)} />
              <Legend />
              <Bar dataKey="Bookings" fill="#8884d8" />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Monthly Totals */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div className="bg-blue-50 p-4 rounded-lg text-center">
          <h2 className="text-gray-700 font-semibold">Total Revenue</h2>
          <div className="text-xl font-bold text-green-600">{formatCurrency(data.monthlyTotals.revenue)}</div>
        </div>
        <div className="bg-blue-50 p-4 rounded-lg text-center">
          <h2 className="text-gray-700 font-semibold">Total Bookings</h2>
          <div className="text-xl font-bold text-purple-600">{formatCurrency(data.monthlyTotals.bookings)}</div>
        </div>
        <div className="bg-blue-50 p-4 rounded-lg text-center">
          <h2 className="text-gray-700 font-semibold">Total Open Orders</h2>
          <div className="text-xl font-bold text-blue-600">{formatCurrency(data.monthlyTotals.openOrders)}</div>
        </div>
      </div>
    </div>
  );
};

export default SimpleDashboard;
